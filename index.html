<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ポイント管理（試運転版 v0.2.2a）</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="top-left">
      <div class="brand">ポイント管理</div>

      <div class="datebar">
        <button id="prevDayBtn" type="button" class="btn ghost">◀</button>
        <input id="dateInput" type="date" class="date" />
        <button id="nextDayBtn" type="button" class="btn ghost">▶</button>
        <button id="todayBtn" type="button" class="btn ghost">今日</button>
      </div>
    </div>

    <div class="top-right">
      <div class="kpi">
        <div class="kpi-label">残高</div>
        <div id="balanceText" class="kpi-value">0.0pt</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">借金</div>
        <div id="debtText" class="kpi-value">0.0pt</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">前日比</div>
        <div id="ydayDiffText" class="kpi-value">+0.0pt</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">前回送信</div>
        <div id="lastSubmitText" class="kpi-value small">—</div>
      </div>
    </div>
  </header>

  <main class="shell">
    <section class="card goal">
      <div class="row space">
        <div>
          <div class="muted">目標まで</div>
          <div id="goalRemainText" class="big">0.0pt</div>
        </div>
        <div class="right">
          <div class="muted">進捗</div>
          <div id="goalPctText" class="big">0%</div>
        </div>
      </div>
      <div class="progress">
        <div id="progressFill" class="fill"></div>
      </div>
    </section>

    <nav class="tabs card">
      <button class="tab active" data-tab="home">入力</button>
      <button class="tab" data-tab="store">ストア</button>
      <button class="tab" data-tab="settings">設定</button>
      <button class="tab" data-tab="files">ファイル</button>
    </nav>

    <!-- HOME -->
    <section id="tab-home" class="card tabpane">
      <div id="debtBanner" class="banner hidden">
        <div>
          <div class="banner-title">借金上限に到達</div>
          <div class="banner-desc">ここに貼れる「相談用メモ」をコピーできます。</div>
        </div>
        <button id="copyConsultBtn" class="btn">相談用メモをコピー</button>
      </div>

      <div class="grid">
        <div class="box">
          <h3>習慣（±ステッパー）</h3>

          <div class="step">
            <div class="label">歯磨き（0〜2）</div>
            <div class="stepper">
              <button class="btn ghost" data-step="tooth" data-d="-1">−</button>
              <div id="toothVal" class="val">0</div>
              <button class="btn ghost" data-step="tooth" data-d="1">＋</button>
            </div>
          </div>

          <div class="step">
            <div class="label">スキンケア（0〜2）</div>
            <div class="stepper">
              <button class="btn ghost" data-step="skin" data-d="-1">−</button>
              <div id="skinVal" class="val">0</div>
              <button class="btn ghost" data-step="skin" data-d="1">＋</button>
            </div>
          </div>

          <div class="step">
            <div class="label">ウォーターフロッサー（0/1）</div>
            <div class="stepper">
              <button class="btn ghost" data-step="water" data-d="-1">−</button>
              <div id="waterVal" class="val">0</div>
              <button class="btn ghost" data-step="water" data-d="1">＋</button>
            </div>
          </div>

          <div class="step">
            <div class="label">日記（0/1）</div>
            <div class="stepper">
              <button class="btn ghost" data-step="diary" data-d="-1">−</button>
              <div id="diaryVal" class="val">0</div>
              <button class="btn ghost" data-step="diary" data-d="1">＋</button>
            </div>
          </div>
        </div>

        <div class="box">
          <h3>継続タスク（状態）</h3>

          <div class="step">
            <div class="label">机（綺麗な区画 0〜5）</div>
            <div class="stepper">
              <button class="btn ghost" data-step="desk" data-d="-1">−</button>
              <div id="deskVal" class="val">0</div>
              <button class="btn ghost" data-step="desk" data-d="1">＋</button>
            </div>
          </div>

          <div class="step">
            <div class="label">床（綺麗な区画 0〜2）</div>
            <div class="stepper">
              <button class="btn ghost" data-step="floor" data-d="-1">−</button>
              <div id="floorVal" class="val">0</div>
              <button class="btn ghost" data-step="floor" data-d="1">＋</button>
            </div>
          </div>

          <div class="step">
            <div class="label">ゴミ袋（満帆じゃない = 1）</div>
            <div class="stepper">
              <button class="btn ghost" data-step="trashOk" data-d="-1">−</button>
              <div id="trashVal" class="val">0</div>
              <button class="btn ghost" data-step="trashOk" data-d="1">＋</button>
            </div>
          </div>

          <div class="muted small">
            ※前日より減った分は「減った数×2」マイナス（ゴミ袋は 1→0 で -3）
          </div>
        </div>

        <div class="box">
          <h3>時間・数値</h3>

          <div class="field">
            <label>MOS（分）</label>
            <input id="mosMin" type="number" inputmode="numeric" min="0" step="1" placeholder="例: 30" />
          </div>

          <div class="field">
            <label>ギター（分）</label>
            <input id="guitarMin" type="number" inputmode="numeric" min="0" step="1" placeholder="例: 20" />
          </div>

          <div class="field">
            <label>昼寝（時間）</label>
            <input id="napHour" type="number" inputmode="decimal" min="0" step="0.1" placeholder="例: 0.5" />
          </div>

          <div class="field">
            <label>LMS平均との差（自分−平均）</label>
            <input id="scoreDiff" type="number" inputmode="numeric" step="1" placeholder="例: +12 / -8" />
          </div>

          
          <div class="step">
            <div class="label">課題出し忘れ（件数）</div>
            <div class="stepper">
              <button class="btn ghost" data-step="forgotCount" data-d="-1">−</button>
              <div id="forgotCountVal" class="val">0</div>
              <button class="btn ghost" data-step="forgotCount" data-d="1">＋</button>
            </div>
          </div>

          <div class="step">
            <div class="label">当日提出（件数）</div>
            <div class="stepper">
              <button class="btn ghost" data-step="sameDayCount" data-d="-1">−</button>
              <div id="sameDayCountVal" class="val">0</div>
              <button class="btn ghost" data-step="sameDayCount" data-d="1">＋</button>
            </div>
          </div>

        </div>

        <div class="box">
          <h3>課題（簡易）</h3>
          <div class="row gap">
            <div class="field">
              <label>増えた数</label>
              <input id="taskAdd" type="number" inputmode="numeric" min="0" step="1" placeholder="0" />
            </div>
            <div class="field">
              <label>完了数</label>
              <input id="taskDone" type="number" inputmode="numeric" min="0" step="1" placeholder="0" />
            </div>
          </div>

          <h3 class="mt">追加項目（カスタム）</h3>
          <div id="customInputsArea" class="customArea muted small">（設定 → 追加 から作れます）</div>

          <h3 class="mt">今日分ログ（入力がある時だけ）</h3>
          <div id="todayMiniLog" class="minilog muted small">（まだ入力がありません）</div>
        </div>
      </div>

      <div class="actions">
        <button id="submitBtn" class="btn primary">送信（反映）</button>
      </div>
    </section>

    <!-- STORE -->
    <section id="tab-store" class="card tabpane hidden">
      <div class="row space">
        <div>
          <h3>ストア（全部：借金OK）</h3>
          <div class="muted small">
            「基準円→pt」タイプは換算（円/pt）に連動。カスタム商品も追加できます。
          </div>
        </div>
      </div>
      <div id="storeList" class="store"></div>

      <div class="box mt">
        <h3>スキンケア（使用中メモ）</h3>
        <div class="muted small">※ストアの購入対象からは外してあります（名前だけ残す）</div>
        <div class="list mt">
          <div class="rowline">
            <div class="name">薬用クリアケア化粧水 300mL</div>
            <div class="meta">使用中</div>
          </div>
          <div class="rowline">
            <div class="name">薬用クリアケアオールインワンジェル 200g</div>
            <div class="meta">使用中</div>
          </div>
        </div>
      </div>


      <div class="box mt">
        <h3>カスタム商品</h3>
        <div id="customStoreList" class="store"></div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="tab-settings" class="card tabpane hidden">
      <h3>設定</h3>

      <div class="grid2">
        <div class="box">
          <h4>換算・丸め</h4>
          <div class="field">
            <label>換算（円 / 1pt）</label>
            <input id="yenPerPt" type="number" min="1" step="1" />
          </div>
          <div class="field">
            <label>丸め刻み（pt）</label>
            <input id="roundStep" type="number" min="0.1" step="0.1" />
          </div>
          <div class="field">
            <label>目標（pt）</label>
            <input id="goalPt" type="number" min="0" step="1" />
          </div>

          <div class="field">
            <label>自販機 基準円</label>
            <input id="vendingBaseYen" type="number" min="0" step="10" />
          </div>

          <div class="field">
            <label>飲酒配信 基準円（仮置き）</label>
            <input id="alcoholBaseYen" type="number" min="0" step="100" />
          </div>

          <div class="field">
            <label>スキンケア特価 係数（例：0.8）</label>
            <input id="skinDiscount" type="number" min="0.1" max="1" step="0.1" />
          </div>
        </div>

        <div class="box">
          <h4>得点係数</h4>
          <div class="row gap">
            <div class="field">
              <label>MOS（1分あたり）</label>
              <input id="mosPerMin" type="number" step="0.1" />
            </div>
            <div class="field">
              <label>ギター（1分あたり）</label>
              <input id="guitarPerMin" type="number" step="0.1" />
            </div>
          </div>

          <div class="row gap">
            <div class="field">
              <label>昼寝（1時間あたり）</label>
              <input id="napPerHour" type="number" step="0.1" />
            </div>
            <div class="field">
              <label>歯磨き（1回）</label>
              <input id="toothPt" type="number" step="0.1" />
            </div>
          </div>

          <div class="row gap">
            <div class="field">
              <label>ウォーターフロッサー（1回）</label>
              <input id="waterPt" type="number" step="0.1" />
            </div>
            <div class="field">
              <label>スキンケア（1回）</label>
              <input id="skinPt" type="number" step="0.1" />
            </div>
          </div>

          <div class="row gap">
            <div class="field">
              <label>日記（1回）</label>
              <input id="diaryPt" type="number" step="0.1" />
            </div>
            <div class="field">
              <label>課題 追加（1件）</label>
              <input id="taskAddPt" type="number" step="0.1" />
            </div>
          </div>

          <div class="row gap">
            <div class="field">
              <label>課題 完了（1件）</label>
              <input id="taskDonePt" type="number" step="0.1" />
            </div>
            <div class="field">
              <label>出し忘れ</label>
              <input id="forgotPt" type="number" step="0.1" />
            </div>
          </div>

          <div class="row gap">
            <div class="field">
              <label>当日提出</label>
              <input id="sameDayPt" type="number" step="0.1" />
            </div>
          </div>

          <div class="row gap">
            <div class="field">
              <label>成績：上回り係数</label>
              <input id="scorePosMul" type="number" step="0.1" />
            </div>
            <div class="field">
              <label>成績：下回り係数</label>
              <input id="scoreNegMul" type="number" step="0.1" />
            </div>
          </div>

          <div class="row gap">
            <div class="field">
              <label>机/床 悪化ペナルティ（1区画あたり）</label>
              <input id="cleanPenaltyPerUnit" type="number" step="0.1" />
            </div>
            <div class="field">
              <label>ゴミ袋 1→0 ペナルティ</label>
              <input id="trashDropPenalty" type="number" step="0.1" />
            </div>
          </div>
        </div>

        <div class="box">
          <h4>調整（±pt）</h4>
          <div class="field">
            <label>調整pt（例：-12.3 / +5）</label>
            <input id="adjustPt" type="number" step="0.1" />
          </div>
          <div class="field">
            <label>理由（必須）</label>
            <input id="adjustMemo" type="text" placeholder="例：誤送信修正" />
          </div>
          <button id="adjustBtn" class="btn">調整を反映（確認あり）</button>
          <div class="muted small mt">※取り消し不可。履歴に残る。</div>
        </div>

        <div class="box">
          <h4>項目を追加（入力/ストア）</h4>

          <div class="row gap">
            <button id="addInputTabBtn" class="btn primary">入力項目</button>
            <button id="addStoreTabBtn" class="btn">ストア商品</button>
          </div>

          <div id="addInputPanel" class="mt">
            <div class="field">
              <label>名前</label>
              <input id="ciName" type="text" placeholder="例：筋トレ" />
            </div>

            <div class="field">
              <label>タイプ</label>
              <select id="ciType" class="select">
                <option value="toggle">トグル（0/1）</option>
                <option value="stepper">ステッパー（0〜N）</option>
                <option value="number">数値入力</option>
              </select>
            </div>

            <div class="row gap">
              <div class="field">
                <label>最大値（ステッパー）</label>
                <input id="ciMax" type="number" step="1" value="1" />
              </div>
              <div class="field">
                <label>係数（pt）</label>
                <input id="ciCoef" type="number" step="0.1" value="1" />
              </div>
            </div>

            <label class="toggle">
              <input id="ciSignSplit" type="checkbox" />
              <span>符号別係数（＋と－で分ける：数値入力用）</span>
            </label>

            <div id="ciSignArea" class="row gap mt hidden">
              <div class="field">
                <label>＋側係数</label>
                <input id="ciPosCoef" type="number" step="0.1" value="0.1" />
              </div>
              <div class="field">
                <label>－側係数（絶対値に掛ける）</label>
                <input id="ciNegCoef" type="number" step="0.1" value="0.5" />
              </div>
            </div>

            <label class="toggle mt">
              <input id="ciPrevPenaltyOn" type="checkbox" />
              <span>前日より悪化したらペナルティ</span>
            </label>

            <div id="ciPrevPenaltyArea" class="row gap mt hidden">
              <div class="field">
                <label>減少1あたり（ステッパー/数値）</label>
                <input id="ciPrevPenaltyPer" type="number" step="0.1" value="2" />
              </div>
              <div class="field">
                <label>1→0（トグル）</label>
                <input id="ciPrevDropPenalty" type="number" step="0.1" value="3" />
              </div>
            </div>

            <div class="row gap mt">
              <button id="ciSaveBtn" class="btn primary">追加 / 更新</button>
              <button id="ciClearBtn" class="btn ghost">クリア</button>
            </div>

            <div class="mt">
              <h4>入力項目一覧</h4>
              <div id="customInputsList" class="list muted small">（まだありません）</div>
            </div>
          </div>

          <div id="addStorePanel" class="mt hidden">
            <div class="field">
              <label>名前</label>
              <input id="csName" type="text" placeholder="例：プロテイン" />
            </div>

            <div class="field">
              <label>タイプ</label>
              <select id="csType" class="select">
                <option value="fixed">固定pt</option>
                <option value="yenBase">基準円 → pt（換算に連動）</option>
                <option value="yen">円 → pt（割引係数あり）</option>
              </select>
            </div>

            <div class="row gap">
              <div class="field">
                <label>固定pt</label>
                <input id="csPt" type="number" step="1" value="100" />
              </div>
              <div class="field">
                <label>基準円</label>
                <input id="csBaseYen" type="number" step="10" value="500" />
              </div>
            </div>

            <div class="row gap">
              <div class="field">
                <label>円（yenタイプ）</label>
                <input id="csYen" type="number" step="10" value="1000" />
              </div>
              <div class="field">
                <label>割引係数（例：0.8）</label>
                <input id="csDiscount" type="number" min="0.1" max="1" step="0.1" value="1" />
              </div>
            </div>

            <div class="field">
              <label>タグ（任意）</label>
              <input id="csTag" type="text" placeholder="例：筋トレ" />
            </div>

            <div class="row gap mt">
              <button id="csSaveBtn" class="btn primary">追加 / 更新</button>
              <button id="csClearBtn" class="btn ghost">クリア</button>
            </div>

            <div class="mt">
              
            <div class="mt">
              <h4>標準ストア商品（変更/削除）</h4>
              <div class="muted small">
                ここで「標準」商品の名前/価格（fixedのみ）を変更したり、非表示（＝削除扱い）にできます。<br/>
                ※履歴は残ります（過去ログは消えません）。
              </div>
              <div class="row gap mt">
                <button id="bsShowAllBtn" class="btn ghost">全て表示に戻す</button>
              </div>
              <div id="builtinStoresList" class="list muted small">（読み込み中）</div>
            </div>

<h4>ストア商品一覧</h4>
              <div id="customStoresList" class="list muted small">（まだありません）</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FILES -->
    <section id="tab-files" class="card tabpane hidden">
      <h3>ファイル（バックアップ/共有）</h3>
      <div class="row gap">
        <button id="exportCsvBtn" class="btn">CSVを書き出し</button>
        <button id="exportJsonBtn" class="btn">JSONを書き出し</button>
      </div>

      <div class="box mt">
        <h4>JSON読み込み</h4>
        <input id="importJson" type="file" accept="application/json" />
        <div class="muted small mt">※読み込みは上書きになります。</div>
      </div>
    </section>
  </main>

  <!-- MODAL -->
  <div id="modal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-head">
        <div id="modalTitle" class="modal-title">確認</div>
        <button id="modalClose" class="btn ghost">×</button>
      </div>
      <div id="modalBody" class="modal-body"></div>
      <div class="modal-foot">
        <button id="modalCancel" class="btn ghost">戻る</button>
        <button id="modalOk" class="btn primary">確定</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
